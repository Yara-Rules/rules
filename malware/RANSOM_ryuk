rule ryuk_custom_packer
{
	meta:
		description = "Rule for detecting the packed Ryuk binary"
		author = "NCSC"
		hash = "b895399bdd8b07b14e1e613329b76911ebe37ab038e4b760f41e237f863b4964"
	strings:
		$ = { 55 8b ec 8b 45 08 8d 04 c5 4d 01 00 00 5d c3 }
		$ = { 83 c4 04 ba ed 6e 46 00 81 ea 1d 4e 06 00 ff e2 8b e5 5d c3 }
		$ = { ba 01 00 00 00 85 d2 74 02 eb f5 8b e5 5d c3 }
		$ = { 8b 45 fc 83 c0 02 89 45 fc 81 7d fc 7b a1 c2 00 73 02 eb ec }
	condition:
		uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x00004550 and all of them
}

rule ryuk_afx_packer
{
	meta:
		description = "Rule for detecting the packed Ryuk binary"
		author = "NCSC"
		hash = "fe55650d8b1b78d5cdb4ad94c0d7ba7052351630be9e8c273cc135ad3fa81a75"
	strings:
		$ = { 3C EB AB AD 17 E5 B3 50 80 18 F1 2A 1C 30 CB 82 }
		$ = "KQAAADFZc3EAAAAAs8ws/pW8/pa4/pa8AWm8/i68/pa8/pa8vpa8/pa8/pa8/pa8/pa8/pa8/pa8/pa8/pa8/pa8/pa8/pa8/pe8/pijRJi8Sp9x3y69sludqv7VjbbM" ascii
		$ = { 52 2F 43 34 16 4E 2D 67 16 4E 2D 67 16 4E 2D 67 40 51 3E 67 36 4E 2D 67 16 4E 2D 67 0D 4E 2D 67 74 51 3E 67 07 4E 2D 67 16 4E 2C 67 C3 4F 2D 67 95 52 23 67 0A 4E 2D 67 FE 51 27 67 98 4E 2D 67 FE 51 26 67 4E 4E 2D 67 AE 48 2B 67 17 4E 2D 67 52 69 63 68 16 4E 2D 67 }
	condition:
		uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x00004550 and all of them
}

rule ryuk_main_artefacts
{
	meta:
		description = "Rule for detecting the main Ryuk payload"
		author = "NCSC"
	strings:
		$ = ".RYK" wide
		$ = "RyukReadMe.html" wide
		$ = "UNIQUE_ID_DO_NOT_REMOVE" wide
		$ = "\\users\\Public\\finish" wide
		$ = "\\users\\Public\\sys" wide
		$ = "\\Documents and Settings\\Default User\\finish" wide
		$ = "\\Documents and Settings\\Default User\\sys" wide
	condition:
		uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x00004550 and all of them
}

rule ryuk_decryptor_strings
{
	meta:
		description = "Rule for detecting the Ryuk decryptor binary"
		author = "NCSC"
		hash = "85e5aff9b169657ba912f4edc019e2d38dd3c3fb2be187309dd65d4ae8732529"
	strings:
		$ = "write full address of file, example \"C:\\mypath\\somepath\\somefile.xls\"" ascii
		$ = "choose next file, 0 for exit" ascii
		$ = "DECRYPT START FOR 30 SECONDS, TURN OFF ALL ANTIVIRUS SOFTWARE" ascii
		$ = "NOTE: don't do anything, just wait, after decrypt has been finished u see the message" ascii
		$ = "rename *.RYK *." ascii
		$ = "System need to reboot, after reboot run decryptor" ascii
		$ = "Ryuk decryptor software" ascii
	condition:
		uint16(0) == 0x5a4d and uint32(uint32(0x3c)) == 0x00004550 and all of them
}
